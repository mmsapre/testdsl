package com.mmsapre.platform.util;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.node.ObjectNode;

import java.util.Collection;
import java.util.Set;

public final class SchemaSanitizer {

    private SchemaSanitizer() {}

    /**
     * Remove given node names from schema.
     * Example: remove "view"
     */
    public static JsonNode removeNodes(
            JsonNode schema,
            Collection<String> nodesToRemove
    ) {
        if (schema == null || !schema.isObject()) {
            return schema;
        }

        ObjectNode copy = schema.deepCopy();
        nodesToRemove.forEach(copy::remove);
        return copy;
    }

    /**
     * Keep ONLY the given node names.
     * Everything else is removed.
     * Example: keep only "view"
     */
    public static JsonNode keepOnlyNodes(
            JsonNode schema,
            Collection<String> nodesToKeep
    ) {
        if (schema == null || !schema.isObject()) {
            return schema;
        }

        ObjectNode copy = schema.deepCopy();
        Set<String> fieldNames =
                Set.copyOf(copy.fieldNames()::forEachRemaining);

        for (String field : fieldNames) {
            if (!nodesToKeep.contains(field)) {
                copy.remove(field);
            }
        }
        return copy;
    }
}
